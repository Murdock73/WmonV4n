#include <EmonLib.h>
#include <Adafruit_Sensor.h>
#include <DHT.h>


// Create an instance
EnergyMonitor emon1;

int rede = 230.0; // Italia 230V  
unsigned long timestampW; 
unsigned long timestampD; 
char temp_send[5];
char hum_send[5];
string W = "W";
string T = "T";
String H = "H";


#define DHTPIN "D8"     // Digital pin connected to the DHT sensor
#define DHTTYPE    DHT22     // DHT 22 (AM2302)
DHT dht(8, DHTTYPE);

// current temperature & humidity, updated in loop()
float temp = 0.0;
float hum = 0.0;

const long intervalDHT = 3000;  
const long intervalW = 999;  


void setup()
{
  Serial.begin(115200);   //Apro la comunicazione seriale
 
  emon1.current(1, 17.5);             // Current: input pin, calibration.

  dht.begin();
  delay(100);

}

void loop()
{
  if ((millis() - timestampW) > intervalW) {
    timestampW = millis();
    double Irms = emon1.calcIrms(1480);  // Calculate Irms only
    int Watt = Irms*rede;
    String Values =  W + watt + T + temp + H + hum;
    Serial.println(Values) 
    
  }

  if ((millis() - timestampD) > intervalDHT) {
    // save the last time you updated the DHT values
    timestampD = millis();
    // Read temperature as Celsius (the default) and Humidity
    float temp = dht.readTemperature();
    float hum = dht.readHumidity();
            
  }
         
}
